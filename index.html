<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>수성구 건강 인프라 지도</title>
  <style>
    #map { width: 100%; height: 600px; margin-top: 10px; }
    #controls { margin-bottom: 10px; }
    label { margin-right: 15px; }
  </style>
</head>
<body>

<h2>🏙️ 수성구 건강 인프라 조회</h2>

<div id="controls">
  <label><input type="radio" name="category" value="hospital" checked> 병원</label>
  <label><input type="radio" name="category" value="sports"> 공공체육시설</label>
  <label><input type="radio" name="category" value="park"> 공원 및 녹지</label><br><br>
  <input type="text" id="address-input" placeholder="예: 대구 수성구 범어로 200" size="50">
  <button onclick="searchLocation()">검색</button>
</div>

<div id="map"></div>
<div id="info" style="margin-top: 10px;"></div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=7b52a2412601870d822f0f4be36667dd=services,geometry"></script>
<script>
  const map = new kakao.maps.Map(document.getElementById('map'), {
    center: new kakao.maps.LatLng(35.8569, 128.6314),
    level: 5
  });

  const geocoder = new kakao.maps.services.Geocoder();
  let userMarker = null;
  let markers = [];

  // 병원, 체육시설, 공원 데이터
  const infraData = {
    hospital: [
      "대구 수성구 달구벌대로 3190",
      "대구 수성구 달구벌대로 2656",
      "대구 수성구 명덕로 414",
      "대구 수성구 화랑로 66",
      "대구 수성구 명덕로 424",
      "대구 수성구 국채보상로 830",
      "대구 수성구 달구벌대로 2348",
      "대구 수성구 화랑로 48",
      "대구 수성구 동대구로 271",
      "대구 수성구 화랑로 58",
      "대구 수성구 무열로 5",
      "대구 수성구 명덕로 443",
      "대구 수성구 달구벌대로 3119",
      "대구 수성구 수성로 194",
      "대구 수성구 신천동로84길 21"
    ],
    sports: [
      "대구 수성구 국채보상로 904 (수성국민체육센터)",
      "대구 수성구 달구벌대로 2501 (범어체력인증센터)",
      "대구 수성구 무열로 105 (수성헬스센터)"
    ],
    park: [ 
      "대구 수성구 황금동 산1 (범어공원)",
      "대구 수성구 범어동 산250 (야시골공원)",
      "대구 수성구 만촌동 1417 (화랑공원)",
      "대구 수성구 만촌동 산407-10 (만촌공원)",
      "대구 수성구 수성4가 1090-15 (수성공원)",
      "대구 수성구 지산동 1274 (지산공원)",
      "대구 수성구 범물동 1328-2 (범물공원)",
      "대구 수성구 신매동 590 (신매공원)",
      "대구 수성구 시지동 501 (노변공원)",
      "대구 수성구 매호동 1321 (매호공원)",
"대구 수성구 황금동 산1 (범어공원)",
  "대구 수성구 범어동 산250 (야시골공원)",
  "대구 수성구 만촌동 1417 (화랑공원)",
  "대구 수성구 만촌동 산407-10 (만촌공원)",
  "대구 수성구 수성4가 1090-15 (수성공원)",
  "대구 수성구 지산동 1274 (지산공원)",
  "대구 수성구 범물동 1328-2 (범물공원)",
  "대구 수성구 신매동 590 (신매공원)",
  "대구 수성구 시지동 501 (노변공원)",
  "대구 수성구 매호동 1321 (매호공원)",
  "대구 수성구 노변동 741 (알파시티공원)",
  "대구 수성구 욱수동 (대구대공원)",
  "대구 수성구 욱수동 (대구체육공원)",
  "대구 수성구 범어2동 416-9 (계림공원)",
  "대구 수성구 범어3동 966-2 (범어재공원)",
  "대구 수성구 만촌1동 656-3 (샛별공원)",
  "대구 수성구 만촌2동 1006-2 (청구공원)",
  "대구 수성구 만촌2동 1017-2 (동원공원)",
  "대구 수성구 만촌2동 1023-11 (광명공원)",
  "대구 수성구 만촌2동 991-8 (무열공원)",
  "대구 수성구 만촌3동 852 (국화공원)",
  "대구 수성구 만촌3동 862 (진달래공원)",
  "대구 수성구 만촌3동 870-13 (만촌공원)",
  "대구 수성구 만촌3동 874-2 (봉선화공원)",
  "대구 수성구 만촌3동 1496 (민들레공원)",
  "대구 수성구 수성동3가 130-2 (새마을공원)",
  "대구 수성구 수성동3가 216 (수성공원)",
  "대구 수성구 수성4가동 1009-2 (호돌이공원)",
  "대구 수성구 황금2동 750 (동신공원)",
  "대구 수성구 황금2동 721 (수목공원)",
  "대구 수성구 황금2동 802 (황금공원)",
  "대구 수성구 황금2동 882-2 (대경공원)",
  "대구 수성구 중동 12 (무궁화공원)",
  "대구 수성구 중동 127 (상록수공원)",
  "대구 수성구 중동 171 (중동공원)",
  "대구 수성구 상동 17 (희망공원)",
  "대구 수성구 상동 54 (청소년공원)",
  "대구 수성구 상동 343 (들안길공원)",
  "대구 수성구 상동 400-1 (덕화공원)",
  "대구 수성구 두산동 41 (샛터공원)",
  "대구 수성구 두산동 141 (아랫마을공원)",
  "대구 수성구 두산동 155 (끝동공원)",
  "대구 수성구 두산동 741-7 (말뫼공원)",
  "대구 수성구 두산동 31-7 (들안길꿈나무공원)",
  "대구 수성구 지산1동 1013 (지산공원)",
  "대구 수성구 지산1동 1265 (세각단공원)",
  "대구 수성구 지산1동 1293 (무학공원)",
  "대구 수성구 지산1동 1287 (지봉공원)",
  "대구 수성구 지산1동 1280 (수동공원)",
  "대구 수성구 지산2동 1184-5 (현대공원)",
  "대구 수성구 지산2동 1211-2 (거성공원)",
  "대구 수성구 지산2동 1272-1 (에덴공원)",
  "대구 수성구 지산2동 1247 (청산공원)",
  "대구 수성구 지산2동 1256 (화성공원)",
  "대구 수성구 범물1동 1279-3 (보성공원)",
  "대구 수성구 범물1동 1283-2 (용지공원)",
  "대구 수성구 범물1동 1288-2 (마산공원)",
  "대구 수성구 범물1동 1302 (배수지공원)",
  "대구 수성구 범물2동 1348 (중앙공원)",
  "대구 수성구 범물2동 1367 (관계지공원)",
  "대구 수성구 범물2동 1376 (범물공원)",
  "대구 수성구 범물2동 1382-1 (삼주공원)",
  "대구 수성구 신매동 579-1 (천마공원)",
  "대구 수성구 신매동 580-2 (청솔공원)",
  "대구 수성구 신매동 586 (신기공원)",
  "대구 수성구 신매동 594-2 (동서공원)",
  "대구 수성구 신매동 595-2 (두성공원)",
  "대구 수성구 신매동 598 (두리공원)",
  "대구 수성구 시지동 137-5 (고산공원)",
  "대구 수성구 시지동 487 (달무리공원)",
  "대구 수성구 시지동 498-1 (미진공원)",
  "대구 수성구 시지동 509-1 (전원공원)",
  "대구 수성구 매호동 1329 (삼각공원)",
  "대구 수성구 매호동 1333 (나래공원)",
  "대구 수성구 매호동 1330-2 (누리공원)",
  "대구 수성구 사월동 646 (사월1공원)",
  "대구 수성구 범어1동 2293 (도담공원)",
  "대구 수성구 파동 1012 (용두공원)",
  "대구 수성구 상동 59-5 (백합공원)",
  "대구 수성구 상동 44 (상동공원)",
  "대구 수성구 두산동 43 (보람공원)",
  "대구 수성구 두산동 149-11 (맑음공원)",
  "대구 수성구 상동 555-1 (상동제1공원)",
  "대구 수성구 상동 555-2 (상동제2공원)",
  "대구 수성구 중동 532-263 (중동공원)",
  "대구 수성구 범물동 790-2 (용지공원)",
  "대구 수성구 파동 1006 (파동공원)",
  "대구 수성구 욱수동 19-2 (사월공원)"

    ]
  };

  function searchLocation() {
    const category = document.querySelector('input[name="category"]:checked').value;
    const inputAddress = document.getElementById('address-input').value;

    geocoder.addressSearch(inputAddress, function(result, status) {
      if (status !== kakao.maps.services.Status.OK) {
        alert("주소를 찾을 수 없습니다.");
        return;
      }

      const userCoords = new kakao.maps.LatLng(result[0].y, result[0].x);
      map.setCenter(userCoords);

      if (userMarker) userMarker.setMap(null);
      userMarker = new kakao.maps.Marker({ map, position: userCoords, title: "내 위치" });

      // 기존 마커 제거
      markers.forEach(marker => marker.setMap(null));
      markers = [];

      const selectedList = infraData[category];
      let found = 0;

      selectedList.forEach(address => {
        geocoder.addressSearch(address, function(res, stat) {
          if (stat === kakao.maps.services.Status.OK) {
            const coords = new kakao.maps.LatLng(res[0].y, res[0].x);
            const distance = kakao.maps.geometry.spherical.computeDistanceBetween(userCoords, coords);

             if (distance <= 1000) {
          const marker = new kakao.maps.Marker({
            map,
            position: coords,
            title: address
          });
          markers.push(marker);

          const infowindow = new kakao.maps.InfoWindow({
            content: `<div style="padding:5px; font-size:14px;">${address}</div>`
          });

          kakao.maps.event.addListener(marker, 'mouseover', function() {
            infowindow.open(map, marker);
          });
          kakao.maps.event.addListener(marker, 'mouseout', function() {
            infowindow.close();
          });

          found++;
        }
      }); // <-- addressSearch의 내부 콜백 닫음
    });   // <-- forEach 닫음

    // 결과 표시
    setTimeout(() => {
      document.getElementById('info').innerText =
        `반경 1km 내 ${category === 'hospital' ? '병원'
        : category === 'sports' ? '공공체육시설'
        : '공원 및 녹지'}: ${found}곳`;
    }, 500);  // 비동기 처리 지연 고려

  });  // <-- 사용자의 주소 검색 함수 닫음
}
</script>

</body>
</html>
